"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[280],{344:(e,t,r)=>{r.d(t,{CA:()=>l,_h:()=>o,y4:()=>s});var a=r(6203),n=r(1304);let o=async(e,t)=>{try{if(!n.j2)throw Error("인증 인스턴스가 초기화되지 않았습니다");let r=await (0,a.x9)(n.j2,e,t);return{success:!0,user:r.user}}catch(e){return{success:!1,error:e.message}}},s=async()=>{try{if(!n.j2)throw Error("인증 인스턴스가 초기화되지 않았습니다");return await (0,a.CI)(n.j2),{success:!0}}catch(e){return{success:!1,error:e.message}}},l=e=>n.j2?(0,a.hg)(n.j2,e):()=>{}},650:(e,t,r)=>{r.d(t,{A:()=>i,AuthProvider:()=>c});var a=r(5155),n=r(2115),o=r(344),s=r(2743);let l=(0,n.createContext)();function c(e){let{children:t}=e,[r,c]=(0,n.useState)(null),[i,u]=(0,n.useState)(null),[d,h]=(0,n.useState)(!0);(0,n.useEffect)(()=>{try{let e=(0,o.CA)(async e=>{if(e)try{let t=await (0,s.gL)(e.uid);c(e),u(t)}catch(t){console.error("사용자 데이터 가져오기 오류:",t),c(e),u(null)}else c(null),u(null);h(!1)});return()=>e&&e()}catch(e){return console.error("인증 상태 리스너 설정 중 오류 발생:",e),h(!1),()=>{}}},[]);let p={user:r,userData:i,loading:d,isAdmin:(null==i?void 0:i.role)==="admin",isTeacher:(null==i?void 0:i.role)==="teacher",isStudent:(null==i?void 0:i.role)==="student",hasRole:e=>!!i&&("admin"===e?"admin"===i.role:"teacher"===e?"admin"===i.role||"teacher"===i.role:"student"===e&&("admin"===i.role||"teacher"===i.role||"student"===i.role))};return(0,a.jsx)(l.Provider,{value:p,children:t})}function i(){return(0,n.useContext)(l)}},1304:(e,t,r)=>{r.d(t,{db:()=>c,j2:()=>i});var a=r(3915),n=r(5317),o=r(858),s=r(6203);let l=0===(0,a.Dk)().length?(0,a.Wp)({apiKey:"AIzaSyARLoCaF3g_z_RcZdU7yp19rgt7YSghGWw",authDomain:"growingbeans-3aa62.firebaseapp.com",projectId:"growingbeans-3aa62",storageBucket:"growingbeans-3aa62.firebasestorage.app",messagingSenderId:"498344379382",appId:"1:498344379382:web:684c82f8f8ab7084a67dd7",measurementId:"G-NJD4T1QKKQ"}):(0,a.Dk)().length>0?(0,a.Dk)()[0]:null,c=l?(0,n.aU)(l):null;l&&(0,o.c7)(l);let i=l?(0,s.xI)(l):null},2743:(e,t,r)=>{r.d(t,{Ln:()=>p,Nj:()=>d,a9:()=>l,gL:()=>c,h5:()=>h,nd:()=>i,xB:()=>u});var a=r(1304),n=r(5317);let o=()=>{if(!a.db)throw Error("Firestore가 초기화되지 않았습니다. 클라이언트 사이드에서만 이 함수를 호출해주세요.");return a.db},s=()=>{let e=o();return(0,n.rJ)(e,"videos")};async function l(e,t){try{let r=o(),a=(0,n.H9)(r,"users",e),s={...t,createdAt:(0,n.O5)(),updatedAt:(0,n.O5)()};return await (0,n.BN)(a,s),{uid:e,...s}}catch(e){throw console.error("사용자 데이터 생성 오류:",e),e}}async function c(e){try{let t=o(),r=(0,n.H9)(t,"users",e),a=await (0,n.x7)(r);if(a.exists())return{uid:a.id,...a.data()};return null}catch(e){throw console.error("사용자 데이터 불러오기 오류:",e),e}}async function i(e,t){try{let r=s(),a=(0,n.P)(r,(0,n._M)("levelId","==",e),(0,n._M)("quarterId","==",t),(0,n._M)("type","==","library")),o=await (0,n.GG)(a),l=[];return o.forEach(e=>{l.push({id:e.id,...e.data()})}),l.sort((e,t)=>e.title.localeCompare(t.title,"ko"))}catch(e){throw console.error("분기별 영상 불러오기 오류:",e),e}}async function u(e,t,r,a){try{let o=s(),l=(0,n.P)(o,(0,n._M)("levelId","==",e),(0,n._M)("quarterId","==",t),(0,n._M)("monthId","==",r),(0,n._M)("weekId","==",a),(0,n._M)("type","==","lesson")),c=await (0,n.GG)(l),i=[];return c.forEach(e=>{i.push({id:e.id,...e.data()})}),i.sort((e,t)=>e.title.localeCompare(t.title,"ko"))}catch(e){throw console.error("주차별 영상 불러오기 오류:",e),e}}async function d(e){try{let t=s(),r={...e,createdAt:(0,n.O5)(),updatedAt:(0,n.O5)()};return{id:(await (0,n.gS)(t,r)).id,...r}}catch(e){throw console.error("비디오 추가 오류:",e),e}}async function h(e,t){try{let r=o(),a=(0,n.H9)(r,"videos",e);return await (0,n.mZ)(a,{...t,updatedAt:(0,n.O5)()}),{id:e,...t}}catch(e){throw console.error("비디오 업데이트 오류:",e),e}}async function p(e){try{let t=o(),r=(0,n.H9)(t,"videos",e);return await (0,n.kd)(r),{success:!0,id:e}}catch(e){throw console.error("비디오 삭제 오류:",e),e}}},5695:(e,t,r)=>{var a=r(8999);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},8273:(e,t,r)=>{r.d(t,{A:()=>o});var a=r(5155),n=r(2115);function o(e){let{videoUrl:t,thumbnail:r,videoId:o=0}=e,s=(0,n.useRef)(null),[l,c]=(0,n.useState)(null),[i,u]=(0,n.useState)(null),[d,h]=(0,n.useState)(!1),[p,f]=(0,n.useState)(!1),[m,w]=(0,n.useState)(0),[y,g]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(window.Hls)return void g(!0);let e=document.createElement("script");return e.src="https://cdn.jsdelivr.net/npm/hls.js@latest",e.async=!0,e.onload=()=>{console.log("HLS.js 스크립트 로드 완료"),g(!0)},e.onerror=()=>{console.error("HLS.js 스크립트 로드 실패"),u("비디오 플레이어를 불러오는 데 실패했습니다.")},document.body.appendChild(e),()=>{}},[]),(0,n.useEffect)(()=>{if(!s.current||!d)return;let e=s.current,t=()=>{document.hidden&&!e.paused&&e.pause()};document.addEventListener("visibilitychange",t);let r=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting||e.paused||e.pause()})},{root:null,rootMargin:"0px",threshold:.1});return r.observe(e),()=>{document.removeEventListener("visibilitychange",t),r.disconnect(),e&&(e.src="",e.load()),l&&(l.destroy(),c(null))}},[d,l]);let v=(0,n.useCallback)(()=>{h(!0),f(!0)},[]),b=(0,n.useCallback)(()=>{u(null),w(e=>e+1),h(!0)},[]);return(0,n.useEffect)(()=>{if(!s.current||!t||!d||!y)return;l&&(l.destroy(),c(null));let e=async()=>{try{let e=t;e.startsWith("https:/")&&!e.startsWith("https://")&&(e=e.replace("https:/","https://")),e.startsWith("//")||e.startsWith("http")||(e="https://"+e),console.log("비디오 ID ".concat(o," 원본 URL:"),e);let r="/api/proxy?url=".concat(encodeURIComponent(e),"&keepKorean=true&timestamp=").concat(Date.now());if(console.log("비디오 ID ".concat(o," 프록시 URL:"),r),window.Hls&&window.Hls.isSupported()){let e=new window.Hls({debug:!1,maxBufferLength:30,maxMaxBufferLength:60,enableWorker:!0,lowLatencyMode:!1,startLevel:-1,fragLoadingTimeOut:6e4,manifestLoadingTimeOut:3e4,fragLoadingMaxRetry:5,manifestLoadingMaxRetry:5,xhrSetup:function(e,t){e.timeout=6e4,e.setRequestHeader("Cache-Control","no-cache"),e.setRequestHeader("Pragma","no-cache")}});c(e),e.on(window.Hls.Events.ERROR,function(t,r){if(console.error("비디오 ID ".concat(o," HLS 에러:"),t,r),r.fatal)switch(r.type){case window.Hls.ErrorTypes.NETWORK_ERROR:console.error("네트워크 오류, 재시도 중..."),e.startLoad();break;case window.Hls.ErrorTypes.MEDIA_ERROR:console.error("미디어 오류, 복구 중..."),e.recoverMediaError();break;default:console.error("복구 불가능한 오류"),u("비디오를 재생할 수 없습니다: ".concat(r.details)),e.destroy()}});try{e.loadSource(r),e.attachMedia(s.current),e.on(window.Hls.Events.MANIFEST_PARSED,function(){console.log("비디오 ID ".concat(o," 매니페스트 파싱 완료")),p&&s.current.play().catch(e=>{console.error("자동 재생 실패:",e)})})}catch(e){console.error("비디오 ID ".concat(o," 로드 오류:"),e),u("비디오 스트림 로드 중 오류가 발생했습니다.")}}else if(s.current.canPlayType("application/vnd.apple.mpegurl"))try{s.current.src=r,p&&s.current.play().catch(e=>{console.error("Safari 자동 재생 실패:",e)})}catch(e){console.error("Safari 비디오 설정 오류:",e),u("Safari에서 비디오 로드 중 오류가 발생했습니다.")}else console.error("HLS가 지원되지 않는 브라우저입니다"),u("이 브라우저는 HLS 비디오 형식을 지원하지 않습니다.")}catch(e){console.error("비디오 ID ".concat(o," 설정 오류:"),e),u("비디오 초기화 중 오류가 발생했습니다.")}},r=setTimeout(()=>{e()},"number"==typeof o?200*o:200);return()=>{clearTimeout(r)}},[t,d,y,m,o,l,p]),(0,a.jsx)(a.Fragment,{children:i?(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:(0,a.jsxs)("div",{className:"text-center p-4",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"❌"}),(0,a.jsx)("p",{className:"text-red-500 mb-2",children:i}),(0,a.jsx)("button",{onClick:b,className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition duration-200",children:"다시 시도"})]})}):d?(0,a.jsx)("video",{ref:s,className:"w-full h-full object-cover",poster:r,controls:!0,playsInline:!0,preload:"metadata"}):(0,a.jsxs)("div",{className:"w-full h-full relative",children:[(0,a.jsx)("img",{src:r||"/thumbnails/default.jpg",alt:"비디오 썸네일",className:"w-full h-full object-cover",loading:"lazy"}),(0,a.jsx)("button",{onClick:v,className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 hover:bg-opacity-40 transition-all","aria-label":"비디오 재생",children:(0,a.jsx)("div",{className:"w-16 h-16 bg-white bg-opacity-80 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-purple-600",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})})})]})})}}}]);