(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[708],{1362:(e,t,r)=>{Promise.resolve().then(r.bind(r,8415))},8415:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var l=r(5155),s=r(5695),n=r(6874),a=r.n(n),o=r(2115),c=r(2743),i=r(3554),d=r(650);let u={q1:"1분기",q2:"2분기",q3:"3분기",q4:"4분기"};function h(e){let{videoUrl:t,thumbnail:r,videoId:s}=e,n=(0,o.useRef)(null),[a,c]=(0,o.useState)(!1),[d,u]=(0,o.useState)(null),[h,m]=(0,o.useState)(!1),[x,p]=(0,o.useState)(!1),f=(0,o.useRef)(null);return(0,o.useEffect)(()=>{if(!n.current||!h)return;let e=n.current,t=()=>{document.hidden&&!e.paused&&e.pause()};document.addEventListener("visibilitychange",t);let r=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting||e.paused||e.pause()})},{root:null,rootMargin:"0px",threshold:.1});return r.observe(e),()=>{document.removeEventListener("visibilitychange",t),r.disconnect(),f.current&&f.current.destroy()}},[h]),(0,o.useEffect)(()=>{if(n.current&&t&&a&&h)try{let e=t;e.startsWith("https:/")&&!e.startsWith("https://")&&(e=e.replace("https:/","https://")),e.startsWith("//")||e.startsWith("http")||(e="https://"+e),console.log("비디오 로딩 URL:",e);let r="/api/proxy?url=".concat(encodeURIComponent(e));if(window.Hls&&window.Hls.isSupported()){f.current&&f.current.destroy();let e=new window.Hls({debug:!1,maxBufferLength:30,maxMaxBufferLength:60,enableWorker:!0,lowLatencyMode:!1,startLevel:-1,abrEwmaDefaultEstimate:5e5,xhrSetup:function(e,t){e.timeout=3e4,console.log("HLS XHR 요청:",t)}});f.current=e,e.on(window.Hls.Events.ERROR,function(t,r){if(console.error("HLS 에러:",t,r),r.fatal)switch(r.type){case window.Hls.ErrorTypes.NETWORK_ERROR:console.error("치명적인 네트워크 오류"),e.startLoad();break;case window.Hls.ErrorTypes.MEDIA_ERROR:console.error("미디어 오류"),e.recoverMediaError();break;default:console.error("복구 불가능한 오류"),u("비디오를 재생할 수 없습니다.")}}),e.loadSource(r),e.attachMedia(n.current),e.on(window.Hls.Events.MANIFEST_PARSED,function(){x&&n.current.play().catch(e=>{console.error("자동 재생 실패:",e)})})}else n.current.canPlayType("application/vnd.apple.mpegurl")?(n.current.src=r,x&&n.current.play().catch(e=>{console.error("자동 재생 실패:",e)})):(console.error("HLS가 지원되지 않는 브라우저입니다"),u("이 브라우저는 비디오 형식을 지원하지 않습니다."))}catch(e){console.error("비디오 설정 오류:",e),u("비디오 로딩 중 오류가 발생했습니다.")}},[t,a,h,x]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.default,{src:"https://cdn.jsdelivr.net/npm/hls.js@latest",onLoad:()=>c(!0),strategy:"lazyOnload"}),d?(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-4xl mb-2",children:"❌"}),(0,l.jsx)("p",{className:"text-red-500",children:d})]})}):h?(0,l.jsx)("video",{ref:n,className:"w-full h-full object-cover",poster:r,controls:!0,playsInline:!0,preload:"metadata"}):(0,l.jsxs)("div",{className:"w-full h-full relative",children:[(0,l.jsx)("img",{src:r||"/thumbnails/default.jpg",alt:"비디오 썸네일",className:"w-full h-full object-cover",loading:"lazy"}),(0,l.jsx)("button",{onClick:()=>{m(!0),p(!0)},className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 hover:bg-opacity-40 transition-all","aria-label":"비디오 재생",children:(0,l.jsx)("div",{className:"w-16 h-16 bg-white bg-opacity-80 rounded-full flex items-center justify-center",children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-purple-600",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})})})]})]})}function m(){let{id:e,quarter:t}=(0,s.useParams)(),[r,n]=(0,o.useState)([]),[i,m]=(0,o.useState)(!0),[x,p]=(0,o.useState)(null),{isAdmin:f,isTeacher:b}=(0,d.A)(),v=f||b,[g,w]=(0,o.useState)(0),[j,y]=(0,o.useState)(new Set);(0,o.useEffect)(()=>{if("undefined"==typeof IntersectionObserver||0===r.length)return;let e=new IntersectionObserver(e=>{e.forEach(e=>{let t=e.target.dataset.videoId;e.isIntersecting&&y(e=>new Set(e).add(t))})},{root:null,rootMargin:"100px",threshold:.1}),t=document.querySelectorAll(".video-container");return t.forEach(t=>e.observe(t)),()=>{e&&(t.forEach(t=>e.unobserve(t)),e.disconnect())}},[r.length]),(0,o.useEffect)(()=>{!async function(){try{m(!0);let r=await (0,c.nd)(e,t);n(r),m(!1)}catch(e){console.error("영상 자료실 데이터 불러오기 오류:",e),p("데이터를 불러오는 중 오류가 발생했습니다."),m(!1)}}()},[e,t,g]);let N=(e,t)=>{let r=e.replace(".m3u8",".mp4").replace("/hls/","/"),l=document.createElement("a");l.href=r,l.download="".concat(t,".mp4"),l.target="_blank",document.body.appendChild(l),l.click(),document.body.removeChild(l)};return(0,l.jsx)("main",{className:"min-h-screen p-8 bg-gradient-to-b from-blue-50 to-purple-50",children:(0,l.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,l.jsx)("div",{className:"mb-8",children:(0,l.jsxs)(a(),{href:"/levels/".concat(e),className:"inline-flex items-center text-purple-600 hover:text-purple-700 font-comic",children:[(0,l.jsx)("svg",{className:"w-6 h-6 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"레벨 ",e,"로 돌아가기"]})}),(0,l.jsxs)("div",{className:"bg-white rounded-2xl p-6 mb-8 border-4 border-white shadow-lg",children:[(0,l.jsxs)("h1",{className:"text-4xl font-bold text-purple-600 mb-4 font-comic",children:[u[t]," 영상 자료실"]}),(0,l.jsx)("p",{className:"text-xl text-gray-600 font-comic",children:"영상을 보면서 즐겁게 배워보아요!"})]}),i?(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)("div",{className:"inline-block animate-bounce text-5xl mb-4",children:"\uD83D\uDD04"}),(0,l.jsx)("p",{className:"text-gray-600 font-comic",children:"영상을 불러오고 있어요..."})]}):x?(0,l.jsxs)("div",{className:"text-center py-12 bg-white rounded-2xl p-6 border-4 border-white shadow-lg",children:[(0,l.jsx)("div",{className:"text-5xl mb-4",children:"\uD83D\uDE15"}),(0,l.jsx)("p",{className:"text-gray-600 font-comic",children:x}),(0,l.jsx)("p",{className:"text-gray-600 font-comic mt-2",children:"잠시 후 다시 시도해주세요."}),(0,l.jsx)("button",{onClick:()=>{p(null),w(e=>e+1)},className:"mt-4 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-comic transition duration-200",children:"다시 시도하기"})]}):r.length>0?(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(e=>(0,l.jsxs)("div",{className:"bg-white rounded-2xl p-4 border-4 border-white shadow-lg transform hover:scale-105 transition-transform duration-300",children:[(0,l.jsx)("div",{className:"aspect-video mb-4 rounded-xl overflow-hidden border-4 border-purple-100 relative video-container","data-video-id":e.id,children:(0,l.jsx)(h,{videoUrl:e.videoUrl,thumbnail:e.thumbnail,videoId:e.id})}),(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-2 font-comic",children:e.title}),(0,l.jsx)("p",{className:"text-gray-600 mb-2 font-comic",children:e.description})]}),v&&(0,l.jsxs)("button",{onClick:()=>N(e.videoUrl,e.title),className:"flex items-center bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded-lg transition duration-200",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"다운로드"]})]})]},e.id))}):(0,l.jsxs)("div",{className:"text-center py-12 bg-white rounded-2xl p-8 border-4 border-white shadow-lg",children:[(0,l.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCED"}),(0,l.jsx)("h2",{className:"text-2xl font-bold text-gray-600 mb-4 font-comic",children:"아직 영상 자료가 없어요"}),(0,l.jsxs)("p",{className:"text-gray-500 font-comic mb-2",children:[u[t]," 영상 자료를 준비 중이에요."]}),(0,l.jsx)("p",{className:"text-gray-500 font-comic",children:"조금만 기다려주세요!"})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,118,288,874,671,441,684,358],()=>t(1362)),_N_E=e.O()}]);